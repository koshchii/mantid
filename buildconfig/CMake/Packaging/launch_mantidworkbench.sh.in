#!/bin/sh
#
# Launch mantidworkbench using any necessary LD_PRELOAD behaviour
#
# Script is configured by CMake

@PREAMBLE@
@JEMALLOC_DEFINITIONS@

@VIRTUAL_GL_WRAPPER@

# Define where python libraries are
LOCAL_PYTHONPATH=@LOCAL_PYPATH@
if [ -n "${PYTHONPATH}" ]; then
    LOCAL_PYTHONPATH=${LOCAL_PYTHONPATH}:${PYTHONPATH}
fi

SETUP_TOOLS_VERS=$(@PYTHON_EXEC_LOCAL@ -c "from setuptools import __version__; print(__version__)" | cut -d . -f1)
if [ "${SETUP_TOOLS_VERS}" -ge "49" ]; then
   # Print red so people notice it when they get a stack trace
   echo "\e[31mSetup tools is >= 49. You may run into issues with a clean build.\e[0m"
   echo "If you are failing to launch with missing modules see https://github.com/mantidproject/mantid/issues/29010"
fi

@GDB_DEFINITIONS@

# Launch the workbench
LD_PRELOAD=${LOCAL_PRELOAD} \
    PYTHONPATH=${LOCAL_PYTHONPATH} @QT_QPA@ \
    @WRAPPER_PREFIX@$VGLRUN $GDB \
    @PYTHON_EXEC_LOCAL@@PYTHON_ARGS@ @MANTIDWORKBENCH_EXEC@ "$@"@WRAPPER_POSTFIX@
